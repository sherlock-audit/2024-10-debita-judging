Lucky Tan Cod

High

# BuyOrder.sol can not return the receipt to buyer

### Summary

BuyOrder.sol is missing functionality to transfer the ordered receipt to the owner of the order

### Root Cause

BuyOrder.sol has a sellNFT() function which transfers the ERC20 to the seller and the NFT from the seller to the contract, but the owner has no way of getting that NFT to themselves.
```solidity
function sellNFT(uint receiptID) public {
        require(buyInformation.isActive, "Buy order is not active");
        require(
            buyInformation.availableAmount > 0,
            "Buy order is not available"
        );

        IERC721(buyInformation.wantedToken).transferFrom(
            msg.sender,
            address(this),
            receiptID
        );
        veNFR receipt = veNFR(buyInformation.wantedToken);
        veNFR.receiptInstance memory receiptData = receipt.getDataByReceipt(
            receiptID
        );
        uint collateralAmount = receiptData.lockedAmount;
        uint collateralDecimals = receiptData.decimals;

        uint amount = (buyInformation.buyRatio * collateralAmount) /
            (10 ** collateralDecimals);
        require(
            amount <= buyInformation.availableAmount,
            "Amount exceeds available amount"
        );

        buyInformation.availableAmount -= amount;
        buyInformation.capturedAmount += collateralAmount;
        uint feeAmount = (amount *
            IBuyOrderFactory(buyOrderFactory).sellFee()) / 10000;
        SafeERC20.safeTransfer(
            IERC20(buyInformation.buyToken),
            msg.sender,
            amount - feeAmount
        );

        SafeERC20.safeTransfer(
            IERC20(buyInformation.buyToken),
            IBuyOrderFactory(buyOrderFactory).feeAddress(),
            feeAmount
        );

        if (buyInformation.availableAmount == 0) {
            buyInformation.isActive = false;
            IBuyOrderFactory(buyOrderFactory).emitDelete(address(this));
            IBuyOrderFactory(buyOrderFactory)._deleteBuyOrder(address(this));
        } else {
            IBuyOrderFactory(buyOrderFactory).emitUpdate(address(this));
        }
    }
```
https://github.com/sherlock-audit/2024-11-debita-finance-v3/blob/main/Debita-V3-Contracts/contracts/buyOrders/buyOrder.sol#L92-L141

### Internal pre-conditions

_No response_

### External pre-conditions

_No response_

### Attack Path

_No response_

### Impact

The receipt NFT is forever stuck in the buyOrder contract.

### PoC

_No response_

### Mitigation

Implement functionality of transferring the receipt to the buy order creator.